
---
import { getCollection, render } from "astro:content";
import Layout from "@/layouts/Layout.astro";
import Prose from "@/components/Prose.astro";
import Sidebar from "@/components/handbook/Sidebar.astro";

export async function getStaticPaths() {
	const pages = await getCollection("handbook");

	return pages
		.filter((page) =>
			import.meta.env.PROD
				? page.data.properties.draft.checkbox !== true
				: true,
		)
		.map((page) => {
			return {
				params: {
					slug: page.data.properties.slug.rich_text[0].plain_text,
				},
				props: {
					page,
				},
			};
		});
}

export type Props = Awaited<ReturnType<typeof getStaticPaths>>[number]["props"];
const { page } = Astro.props;

const { Content } = await render(page);
---

<Layout title="Handbook">
  <section id="main" class="flex gap-12 px-256 text-text min-h-screen pt-96 pb-64">
    <Sidebar image={page.data.properties.category.select?.name || "organization"} />
    <div id="content" class="bg-fg-1 border border-stroke rounded-16 w-full h-fit min-h-screen flex flex-col p-32 gap-24 items-center">
      <div class="max-w-[32rem] w-full flex flex-col gap-24">
      <h1 class="text-h1">{page.data.properties.Name.title[0].plain_text}</h1>
        <Prose><Content /></Prose>
      </div>
    </div>
  </section>
</Layout>
